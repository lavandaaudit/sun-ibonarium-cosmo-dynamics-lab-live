<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Живе Сонце • SDO AIA</title>
<style>
/* ================= RESET & BODY ================= */
* { margin: 0; padding: 0; box-sizing: border-box; }
html, body {
  width: 100%;
  height: 100%;
  background: #000;
  color: #9fe7ff;
  font-family: "Courier New", monospace;
  overflow: hidden;
}
/* ================= STARS BACKGROUND ================= */
#starsCanvas {
  position: fixed;
  inset: 0;
  z-index: 0;
}
/* ================= SUN CANVAS ================= */
#sunCanvas {
  position: fixed;
  inset: 0;
  z-index: 1;
}
/* ================= WRAPPER (внизу) ================= */
.wrapper {
  position: fixed;
  bottom: 20px;
  left: 0;
  right: 0;
  z-index: 2;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  padding: 10px;
  pointer-events: none;
}
.controls {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  gap: 10px;
  pointer-events: auto;
}
button {
  background: transparent;
  border: 1px solid #4dd2ff;
  color: #4dd2ff;
  font-family: "Courier New", monospace;
  font-size: 13px;          /* трохи менший шрифт */
  padding: 6px 12px;        /* менші кнопки */
  border-radius: 6px;
  cursor: pointer;
  transition: 0.3s;
  pointer-events: auto;
}
button:hover {
  background: rgba(77,210,255,0.15);
  box-shadow: 0 0 12px rgba(77,210,255,0.6);
}
button.active {
  background: #4dd2ff;
  color: #000;
  box-shadow: 0 0 20px #4dd2ff;
}
/* ================= TEXT ================= */
.text-block {
  display: flex;
  flex-direction: column;
  gap: 4px;
  text-align: center;
  pointer-events: auto;
}
.main-text { font-size: 16px; letter-spacing: 1px; }
.sub-text { font-size: 13px; letter-spacing: 1px; opacity: 0.8; }
.footer-text { 
  font-size: 11px; 
  letter-spacing: 1px; 
  opacity: 0.6; 
}
.footer-text a {
  color: #4dd2ff;
  text-decoration: underline;
}
/* ================= MOBILE ================= */
@media (max-width: 600px) {
  button { 
    font-size: 11px; 
    padding: 5px 10px; 
  }
  .main-text { font-size: 14px; }
  .sub-text { font-size: 12px; }
  .footer-text { font-size: 10px; }
  .wrapper { bottom: 10px; gap: 8px; }
}
</style>
</head>
<body>
<canvas id="starsCanvas"></canvas>
<canvas id="sunCanvas"></canvas>
<div class="wrapper">
  <div class="controls">
    <button id="minusBtn">–</button>
    <button id="plusBtn">+</button>
    <button class="channelBtn active" data-ch="171">171 Å</button>
    <button class="channelBtn" data-ch="304">304 Å</button>
    <button class="channelBtn" data-ch="193">193 Å</button>
    <button class="channelBtn" data-ch="211">211 Å</button>
  </div>
  <div class="text-block">
    <div class="main-text" id="photoTime">завантаження...</div>
    <div class="sub-text">
      Ibonarium Cosmo Dynamics Lab LIVE — Center for Space & Planetary Monitoring
    </div>
    <div class="footer-text">
      <a href="https://t.me/ibonariumcosmodynamicslablive" target="_blank">
        https://t.me/ibonariumcosmodynamicslablive
      </a>
      <br>
      2026 ibonarium project
    </div>
  </div>
</div>
<script>
/* ================= STARS BACKGROUND ================= */
const starsCanvas = document.getElementById("starsCanvas");
const sctx = starsCanvas.getContext("2d");
let W = starsCanvas.width = window.innerWidth;
let H = starsCanvas.height = window.innerHeight;
const stars = [];
const numStars = 300;
for (let i = 0; i < numStars; i++) {
  stars.push({
    x: Math.random() * W,
    y: Math.random() * H,
    size: Math.random() * 1.5 + 0.5,
    speed: Math.random() * 0.5 + 0.1,
    opacity: Math.random() * 0.8 + 0.2
  });
}
function drawStars() {
  sctx.clearRect(0, 0, W, H);
  sctx.fillStyle = "#fff";
  stars.forEach(star => {
    sctx.globalAlpha = star.opacity;
    sctx.fillRect(star.x, star.y, star.size, star.size);
    star.y += star.speed;
    if (star.y > H) star.y = 0;
  });
  sctx.globalAlpha = 1;
  requestAnimationFrame(drawStars);
}
drawStars();

/* ================= SUN CANVAS ================= */
const sunCanvas = document.getElementById('sunCanvas');
const ctx = sunCanvas.getContext('2d');
sunCanvas.width = W;
sunCanvas.height = H;
let scale = 0.4;
let channel = 171;
let img = new Image();
const photoTimeEl = document.getElementById("photoTime");
const fallbackURL = "https://upload.wikimedia.org/wikipedia/commons/4/4f/Sun_in_visible_light.jpg";
const channelMap = {
  171: "0171",
  304: "0304",
  193: "0193",
  211: "0211"
};
const resolution = "1024";

async function loadSun(ch = 171) {
  const chStr = channelMap[ch] || "0171";
  const url = `https://sdo.gsfc.nasa.gov/assets/img/latest/latest_${resolution}_${chStr}.jpg`;
  return new Promise((resolve) => {
    img.onload = () => {
      const now = new Date();
      photoTimeEl.textContent = now.toISOString().replace("T", " ").split(".")[0] + " UTC (прибл.)";
      drawSun();
      resolve();
    };
    img.onerror = () => {
      console.warn("Fallback до статичного зображення");
      photoTimeEl.textContent = "немає зв'язку (static)";
      img.src = fallbackURL;
      drawSun();
      resolve();
    };
    img.src = url + "?" + Date.now();
  });
}

function drawSun() {
  ctx.clearRect(0, 0, W, H);
  if (img.complete && img.naturalWidth > 0) {
    const w = img.width * scale;
    const h = img.height * scale;
    ctx.drawImage(img, (W - w) / 2, (H - h) / 2, w, h);
  }
}

/* ================= КЕРУВАННЯ ================= */
document.getElementById("minusBtn").addEventListener("click", () => {
  scale = Math.max(0.4, scale - 0.15);
  drawSun();
});
document.getElementById("plusBtn").addEventListener("click", () => {
  scale = Math.min(2.5, scale + 0.15);
  drawSun();
});

document.querySelectorAll(".channelBtn").forEach(btn => {
  btn.addEventListener("click", async () => {
    channel = parseInt(btn.dataset.ch);
    document.querySelectorAll(".channelBtn").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    photoTimeEl.textContent = "завантаження...";
    await loadSun(channel);
  });
});

sunCanvas.addEventListener("wheel", e => {
  e.preventDefault();
  if (e.deltaY < 0) scale = Math.min(2.5, scale + 0.15);
  if (e.deltaY > 0) scale = Math.max(0.4, scale - 0.15);
  drawSun();
});

/* ================= АВТООНОВЛЕННЯ ================= */
setInterval(() => loadSun(channel), 300000); // кожні 5 хвилин

/* ================= РЕСАЙЗ ================= */
window.addEventListener("resize", () => {
  W = starsCanvas.width = sunCanvas.width = window.innerWidth;
  H = starsCanvas.height = sunCanvas.height = window.innerHeight;
  drawSun();
});

/* ================= СТАРТ ================= */
loadSun(channel);
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Живе Сонце • SDO AIA</title>
<style>
/* ================= RESET ================= */
* { margin:0; padding:0; box-sizing:border-box; }
html, body { width:100%; height:100%; background:#000; color:#9fe7ff; font-family:"Courier New", monospace; overflow:hidden; }

/* ================= CANVAS ================= */
#hackerCanvas, #sunCanvas { position:fixed; inset:0; z-index:0; }
#sunCanvas { z-index:1; }

/* ================= WRAPPER ================= */
.wrapper {
  position:relative;
  z-index:2;
  width:100%;
  max-width:1000px;
  margin:0 auto;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  gap:15px;
  text-align:center;
  padding:10px;
}

/* ================= BUTTONS ================= */
.controls {
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:10px;
  margin-bottom:10px;
}
button {
  background:transparent;
  border:1px solid #4dd2ff;
  color:#4dd2ff;
  font-family:"Courier New", monospace;
  font-size:14px;
  padding:8px 16px;
  border-radius:6px;
  cursor:pointer;
  transition:0.3s;
}
button:hover { background: rgba(77,210,255,0.15); box-shadow:0 0 12px rgba(77,210,255,0.6); }
button.active { background:#4dd2ff; color:#000; box-shadow:0 0 20px #4dd2ff; }

/* ================= TEXT ================= */
.text-block { display:flex; flex-direction:column; gap:4px; margin-top:6px; }
.main-text { font-size:16px; letter-spacing:1px; }
.sub-text { font-size:13px; letter-spacing:1px; opacity:0.8; }
.footer-text { font-size:10px; letter-spacing:1px; opacity:0.45; }

/* ================= MOBILE ================= */
@media (max-width:600px) {
  button { font-size:12px; padding:6px 12px; }
  .main-text { font-size:14px; }
  .sub-text { font-size:12px; }
  .footer-text { font-size:9px; }
}
</style>
</head>
<body>

<canvas id="hackerCanvas"></canvas>
<canvas id="sunCanvas"></canvas>

<div class="wrapper">
  <div class="controls">
    <button id="minusBtn">–</button>
    <button id="plusBtn">+</button>
    <button id="saveBtn">ЗБЕРЕГТИ (JPEG)</button>
  </div>

  <div class="controls">
    <button class="channelBtn" data-ch="171">171</button>
    <button class="channelBtn" data-ch="304">304</button>
    <button class="channelBtn" data-ch="193">193</button>
    <button class="channelBtn" data-ch="211">211</button>
  </div>

  <div class="text-block">
    <div class="main-text" id="photoTime">завантаження...</div>
    <div class="sub-text">
      Ibonarium Cosmo Dynamics Lab LIVE — Center for Space & Planetary Monitoring
    </div>
    <div class="footer-text">
      2026 ibonarium project
    </div>
  </div>
</div>

<script>
/* ================= HACKER EFFECT ================= */
const hackerCanvas = document.getElementById("hackerCanvas");
const hctx = hackerCanvas.getContext("2d");
let W = hackerCanvas.width = window.innerWidth;
let H = hackerCanvas.height = window.innerHeight;

const letters = "0123456789ABCDEF$@#%^&*()[]{}<>/\\|";
const fontSize = 14;
const columns = Math.floor(W / fontSize);
const drops = Array(columns).fill(1);

function drawHacker() {
  hctx.fillStyle = "rgba(0,0,0,0.05)";
  hctx.fillRect(0,0,W,H);
  hctx.fillStyle = "#0ff";
  hctx.font = fontSize + "px Courier New";
  for(let i=0;i<drops.length;i++){
    const text = letters[Math.floor(Math.random()*letters.length)];
    hctx.fillText(text, i*fontSize, drops[i]*fontSize);
    if(drops[i]*fontSize > H && Math.random() > 0.975) drops[i]=0;
    drops[i]++;
  }
  requestAnimationFrame(drawHacker);
}
drawHacker();

/* ================= SUN CANVAS ================= */
const sunCanvas = document.getElementById('sunCanvas');
const ctx = sunCanvas.getContext('2d');
sunCanvas.width = W;
sunCanvas.height = H;

let scale = 1.0;
let channel = 171;
let img = new Image();
let photoTimeEl = document.getElementById("photoTime");

// Функція формує URL NASA SDO для поточного часу
function getSunURL(ch) {
  const now = new Date();
  const yyyy = now.getUTCFullYear();
  const mm = String(now.getUTCMonth()+1).padStart(2,'0');
  const dd = String(now.getUTCDate()).padStart(2,'0');
  const hh = String(now.getUTCHours()).padStart(2,'0');
  const min = String(now.getUTCMinutes()).padStart(2,'0');
  return `https://sdo.gsfc.nasa.gov/assets/img/browse/${yyyy}/${mm}/${dd}/${yyyy}${mm}${dd}_${hh}${min}_${ch}.jpg`;
}

function loadSun(ch = 171) {
  const url = getSunURL(ch);
  img = new Image();
  img.crossOrigin = "anonymous";
  img.src = url;
  photoTimeEl.textContent = "оновлюється live...";
  img.onload = () => {
    const now = new Date();
    photoTimeEl.textContent = `${now.getUTCFullYear()}-${String(now.getUTCMonth()+1).padStart(2,'0')}-${String(now.getUTCDate()).padStart(2,'0')} ${String(now.getUTCHours()).padStart(2,'0')}:${String(now.getUTCMinutes()).padStart(2,'0')} UTC`;
    drawSun();
  };
  img.onerror = () => {
    // fallback
    img.src = "https://upload.wikimedia.org/wikipedia/commons/4/4f/Sun_in_visible_light.jpg";
    photoTimeEl.textContent = "немає live-зв'язку (static)";
  };
}

function drawSun() {
  ctx.clearRect(0,0,W,H);
  if(img.complete){
    const w = img.width * scale;
    const h = img.height * scale;
    ctx.drawImage(img, (W-w)/2, (H-h)/2, w, h);
  }
}

/* ================= BUTTONS ================= */
document.getElementById("minusBtn").addEventListener("click", ()=>{ scale=Math.max(0.4,scale-0.15); drawSun(); });
document.getElementById("plusBtn").addEventListener("click", ()=>{ scale=Math.min(2.5,scale+0.15); drawSun(); });
document.getElementById("saveBtn").addEventListener("click", ()=>{
  const link = document.createElement('a');
  link.download = `Сонце_AIA${channel}_${new Date().toISOString().replace(/[:.]/g,"-")}.jpg`;
  link.href = sunCanvas.toDataURL("image/jpeg");
  link.click();
});

document.querySelectorAll(".channelBtn").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    channel = btn.dataset.ch;
    document.querySelectorAll(".channelBtn").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active");
    loadSun(channel);
  });
});

// Масштаб колесом
sunCanvas.addEventListener("wheel", e=>{
  if(e.deltaY<0) scale=Math.min(2.5,scale+0.15);
  if(e.deltaY>0) scale=Math.max(0.4,scale-0.15);
  drawSun();
  e.preventDefault();
});

// Автооновлення раз на 5 хвилин
setInterval(()=>{ loadSun(channel); },300000);

window.addEventListener("resize", ()=>{
  W=hackerCanvas.width=sunCanvas.width=window.innerWidth;
  H=hackerCanvas.height=sunCanvas.height=window.innerHeight;
  drawSun();
});

// Початкове завантаження
loadSun(channel);
</script>

</body>
</html>
